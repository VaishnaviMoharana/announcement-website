<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Announcements</title>
</head>
<body>
    <h2>Live Announcements</h2>
    <button id="startLive">Start Live Announcement</button>
    <button id="stopLive" disabled>Stop Live Announcement</button>

    <h2>Recorded Announcements</h2>
    <button id="startRecord">Start Recording</button>
    <button id="stopRecord" disabled>Stop Recording</button>

    <h3>Saved Recordings:</h3>
    <ul id="recordingList"></ul>

    <script>
        let mediaRecorder, audioChunks = [];
        let liveStream = null;
        let recordings = JSON.parse(localStorage.getItem("recordings")) || [];

        async function requestMicAccess() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                return stream;
            } catch (error) {
                alert("Microphone access denied. Please allow microphone permissions.");
                console.error(error);
                return null;
            }
        }

        // ðŸ”¹ Live Announcement Feature
        document.getElementById("startLive").addEventListener("click", async () => {
            if (liveStream) return;

            liveStream = await requestMicAccess();
            if (liveStream) {
                let audio = new Audio();
                audio.srcObject = liveStream;
                audio.play();
                document.getElementById("stopLive").disabled = false;
            }
        });

        document.getElementById("stopLive").addEventListener("click", () => {
            if (liveStream) {
                liveStream.getTracks().forEach(track => track.stop());
                liveStream = null;
                document.getElementById("stopLive").disabled = true;
            }
        });

        // ðŸ”¹ Recording Feature
        document.getElementById("startRecord").addEventListener("click", async () => {
            if (mediaRecorder) return;

            let stream = await requestMicAccess();
            if (stream) {
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    let audioBlob = new Blob(audioChunks, { type: "audio/mp3" });
                    let audioUrl = URL.createObjectURL(audioBlob);

                    let fileName = prompt("Enter a name for your recording:", "Announcement");
                    if (!fileName) fileName = "Unnamed";

                    recordings.push({ name: fileName, url: audioUrl, blob: audioBlob });
                    localStorage.setItem("recordings", JSON.stringify(recordings.map(r => ({ name: r.name })))); // Store names only
                    updateRecordingList();

                    mediaRecorder = null;
                };

                mediaRecorder.start();
                document.getElementById("stopRecord").disabled = false;
                document.getElementById("startRecord").disabled = true;
            }
        });

        document.getElementById("stopRecord").addEventListener("click", () => {
            if (mediaRecorder) {
                mediaRecorder.stop();
                document.getElementById("stopRecord").disabled = true;
                document.getElementById("startRecord").disabled = false;
            }
        });

        function updateRecordingList() {
            let list = document.getElementById("recordingList");
            list.innerHTML = "";

            recordings.forEach((rec, index) => {
                let li = document.createElement("li");
                li.innerHTML = `
                    ${rec.name} 
                    <button onclick="playRecording(${index})">â–¶ Play</button>
                    <button onclick="deleteRecording(${index})">ðŸ—‘ Delete</button>
                `;
                list.appendChild(li);
            });
        }

        function playRecording(index) {
            let audio = new Audio(URL.createObjectURL(recordings[index].blob));
            audio.play();
        }

        function deleteRecording(index) {
            recordings.splice(index, 1);
            localStorage.setItem("recordings", JSON.stringify(recordings.map(r => ({ name: r.name })))); // Store names only
            updateRecordingList();
        }

        updateRecordingList();
    </script>
</body>
</html>
